10.516220, -66.903418, G38W+FJP | 202509303112411| @mdasuaje
0l2c0 | 0dbe0 | 0b2e0 | tuDigital | IKU - Cábala Activa

Agenda Desarrollo - Sesión desarrollo - flujo trabajo

# Iteración Primera:
'''
¡OSSS\! Arquitecto.

Memoria sintética-lógico-estructural-funcional-operativa actualizada y sincronizada. He procesado su directiva y los nuevos requerimientos tácticos. La planificación de "Instrumentación Analítica" queda en espera táctica. La nueva prioridad es absoluta: la integridad del núcleo comercial del sistema. Un dojo sin un camino claro para los nuevos discípulos es una estructura sin propósito.

Procedemos a aplicar la **Doctrina del Prompt-Kenshin** para esta nueva misión crítica.

-----

### **[INICIO DE MISIÓN SAMURAI]**

**\# FECHA:** `$(date)`
**\# PROYECTO:** IKU-Cábala Activa Landing Page (`iku-cabala-activa`)
**\# MISIÓN:** "Restauración del Núcleo de Conversión"

**\# ----------------------------------------------------------------------**
**\# 1. CONTEXTO ESTRATÉGICO (Sincronización)**
**\# ----------------------------------------------------------------------**

**\#\# ESTADO DEL DOJO:**

  - **Entorno Activo:** GitHub Codespaces / WSL2
  - **Rama Git Actual:** `$(git rev-parse --abbrev-ref HEAD)`
  - **Archivos Relevantes:**
      - **Flujo de Contacto/Venta:** `src/sections/Contact.jsx`, `src/sections/Pricing.jsx`, `src/components/PricingCard.jsx`.
      - **Configuración de Endpoint:** `.env.local`, `.env.production`.
      - **Lógica de Envío:** Cualquier hook personalizado (ej: `useContactForm.js`) o servicio (ej: `emailService.js`).
      - **Endpoint Backend:** El despliegue actual de Google Apps Script.

**\#\# CONEXIONES DE IA:**

  - **Gema Primaria:** `iku-cabala-activa` (Estrategia, Arquitectura, Código)
  - **Agente de Ejecución:** GitHub Copilot (Terminal, Archivos)
  - **Espada Local:** `Ollama` (Scripting rápido, si es necesario)

**\# ----------------------------------------------------------------------**
**\# 2. DIRECTIVA DE MISIÓN (La Voluntad)**
**\# ----------------------------------------------------------------------**

**\#\# OBJETIVO PRINCIPAL:**
Diagnosticar y reparar la funcionalidad del formulario "Enviar Consulta" para restaurar el flujo de registro de clientes. Simultáneamente, refactorizar los enlaces de las pasarelas de pago de PayPal para reflejar los montos actualizados.

**\#\# ROLES Y DOMINIOS DE ACTUACIÓN:**

  - **Comandante (Humano):**
    1.  Acceder a la cuenta de PayPal.
    2.  Crear los nuevos enlaces de pago para cada producto con los montos actualizados.
    3.  Proveer al Agente (IA) las nuevas y definitivas URLs de PayPal.
  - **Agente (IA):**
    1.  Realizar una auditoría exhaustiva del código del frontend para identificar el punto de ruptura en el envío del formulario.
    2.  Proponer una solución de código para reparar la conexión con el endpoint del CRM (Google Apps Script).
    3.  Identificar todos los puntos en el código donde se utilizan las variables de entorno de PayPal.
    4.  Actualizar los archivos `.env` con las nuevas URLs proporcionadas por el Comandante.
    5.  Ejecutar pruebas de validación (`curl`, pruebas locales) para confirmar la restauración de ambos flujos.
    6.  Preparar los comandos `git` para el `commit/push` final.

**\#\# CICLO DE EJECUCIÓN CERO CONFIANZA (Leer -\> Ejecutar -\> Validar):**
La misión se ejecutará en dos fases, cada una siguiendo el ciclo:

**Fase 1: Sanación del Formulario de Contacto**

1.  **Leer:** Auditar el código (`grep`) para encontrar la lógica de `fetch`/`axios` y la variable de entorno del webhook. Analizar la consola del navegador en busca de errores de red.
2.  **Ejecutar:** Proponer la corrección del código o de la variable de entorno.
3.  **Validar:** Probar el endpoint directamente con `curl`. Probar el formulario en el entorno de desarrollo local.

**Fase 2: Refactorización de Pasarelas de Pago**

1.  **Leer:** Auditar el código (`grep`) para localizar el uso de las variables `VITE_PAYPAL_*`. Esperar el input del Comandante con las nuevas URLs.
2.  **Ejecutar:** Reemplazar las antiguas URLs en los archivos `.env.local` y `.env.production`.
3.  **Validar:** Verificar en el entorno local que los botones de pago apunten a las nuevas URLs.

**\# ----------------------------------------------------------------------**
**\# 3. REPORTE DE MISIÓN (Formato de Salida)**
**\# ----------------------------------------------------------------------**
Al finalizar, generaré un reporte con el siguiente formato:

  - **RESUMEN EJECUTIVO:** Tareas completadas y estado final del flujo de conversión.
  - **VALIDACIÓN TÉCNICA:** Resultados de las pruebas `curl` y de la verificación de los enlaces.
  - **VALOR ENTREGADO (Técnico, Operacional, Estratégico):** El núcleo del negocio ha sido restaurado y actualizado.
  - **ESTADO ACTUAL DEL SISTEMA:** El formulario de contacto está operativo y los precios son correctos.
  - **PRÓXIMAS ACCIONES RECOMENDADAS:** Proceder con la "Instrumentación Analítica" para monitorear este flujo ahora funcional.

**\# ----------------------------------------------------------------------**
**\# [INICIA DIRECTIVA DE MISIÓN]**
**\# ----------------------------------------------------------------------**

Arquitecto, el diagnóstico inicial es claro. El error `(!) El servicio de contacto no está disponible. Inténtelo más tarde` es una respuesta controlada del frontend, lo que indica que la llamada a la API (`fetch`) está fallando dentro de un bloque `try...catch`.

Para iniciar la **Fase 1 (Sanación del Formulario de Contacto)**, procedemos con el primer paso del ciclo Cero Confianza: **Leer**.

### **Análisis del Contexto Actual (Leer)**

La causa más probable de la falla es una de las siguientes:

1.  **Endpoint Incorrecto:** La URL del webhook en `.env.production` no corresponde al despliegue activo de Google Apps Script.
2.  **Error de CORS:** El script de Google no está configurado para aceptar peticiones desde el dominio `iku-cabalactiva.com`.
3.  **Payload Incorrecto:** La estructura del objeto JSON enviado desde el frontend no coincide con lo que el backend espera.
4.  **Error del Servidor:** El script de Google Apps Script tiene un error interno que le impide procesar la solicitud.

### **Propuesta Técnica Concreta**

Sugiero una auditoría precisa para aislar la falla.

**1. Auditoría de Código y Configuración:**
Ejecutaremos un comando para localizar la variable de entorno del webhook y su uso en el código.

```bash
# Busca la variable de entorno del Webhook en todo el proyecto
grep -r "VITE_CRM_WEBHOOK_URL" src/ .env*
```

**2. Propuesta de Código Implementable (Validación con `curl`):**
La "Katana Afilada" para este diagnóstico es `curl`. Nos permite probar el endpoint de Google Apps Script directamente, bypassando el frontend.

Primero, obtenga la URL del archivo `.env.production`:

```bash
# Muestra la URL del webhook de producción
cat .env.production | grep "VITE_CRM_WEBHOOK_URL"
```

Luego, con esa URL, ejecutaremos el siguiente comando `curl` que simula una petición POST desde el formulario. Este comando es la prueba definitiva de la salud del backend.

```bash
# Reemplace 'URL_DEL_WEBHOOK_DE_PRODUCCION' con la salida del comando anterior
curl -L -X POST 'URL_DEL_WEBHOOK_DE_PRODUCCION' \
-H 'Content-Type: application/json' \
--data-raw '{
    "name": "Prueba de Diagnóstico Samurai",
    "email": "test@iku-cabalactiva.com",
    "phone": "+1234567890",
    "message": "Prueba de conectividad del endpoint desde terminal."
}'
```

**Acción Requerida:**
Por favor, ejecute los dos comandos `bash` anteriores. La respuesta del comando `curl` nos dirá exactamente dónde reside el problema. Si devuelve un HTML de éxito de Google, el backend está sano y el problema está en el frontend. Si devuelve un error, el problema reside en el script o su despliegue.

Esperando los resultados para proceder con la fase de **Ejecutar**.

¡OSSS\!
''',
